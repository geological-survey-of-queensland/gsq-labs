<!DOCTYPE html>
<!-- saved from url=(0056)http://gowminerals.byethost33.com/index_SilicaSands.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Silica Sands Prospectivity</title>
  
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="./Silica Sands Prospectivity_files/leaflet.css">
    <link rel="stylesheet" href="./Silica Sands Prospectivity_files/css">
    <link rel="stylesheet" href="./Silica Sands Prospectivity_files/css(1)">
    <style>
      html,
      body {
        font-family: "Lato", sans-serif;
        margin: 0;
        padding: 0;
        min-height: 100%;
        width: 100%;
        box-sizing: border-box;
      }

      h1,
      h2,
      h3,
      h4,
      h5,
      h6 {
        font-family: "Lato", sans-serif;
        font-weight: bold;
      }

      p {
        font-size: small;
        font-family: "Lato", sans-serif;
      }

      span {
        font-size: 14px;
        font-family: "Lato", sans-serif;
      }

      h2 {
        text-align: center;
      }

      #map {
        bottom: 0;
        width: 100%;
        position: absolute;
        right: 0;
        top: 0;
        min-height: 100%;
        left: 290px;
      }

      .button {
        background: white;
        border-radius: 6px;
        border: 2px solid #7e2e9d;
        box-shadow: 0 1px 3px 0 rgb(49 185 141 / 30%);
        cursor: pointer;
        height: 80px;

        display: block;
        text-align: center;
        text-decoration: none;
        width: 120px;
        font-size: 20px;
        margin-right: 5px;
        margin-top: 15px;
      }

      .button:hover {
        background-color: #7e2e9d;
        color: white;
      }

      .button:active {
        background-color: #7e2e9d;
        box-shadow: 0 5px #666;
        transform: translateY(4px);
      }

      .slidecontainer * {
        display: inline-block;
        width: 15%;
      }

      .vertical > * {
        display: block;
        width: 100%;
      }

      .vertical2 > * {
        display: block;
        width: 100%;
      }

      .vertical2 {
        margin: 5px;
      }

      .vertical3 > * {
        display: block;
        width: 100%;
        text-align: center;
        margin-left: 5%;
        font-weight: bold;
      }

      .vertical3 {
        margin-left: 8px;
      }

      #leftmenu {
        overflow: auto;
        background: white;
        bottom: 0;
        box-shadow: 1px 0 3px 0 rgb(0 0 0 / 30%);
        color: #13293d;
        font-family: "Open Sans";
        left: 0;
        position: absolute;
        top: 0;
        width: 250px;
        z-index: 1000;
        min-height: 100%;
        padding-left: 24px;
        padding-right: 24px;
      }

      #categoryselection {
        padding-top: 18px;
      }

      select {
        background-position: center right;
        background-repeat: no-repeat;
        border: 1px solid #aaa;
        border-radius: 2px;
        box-shadow: 0px 1px 3px rgba(0, 0, 0, 0.1);
        color: #555;
        font-size: inherit;
        margin: 0;
        overflow: hidden;
        padding-top: 2px;
        padding-bottom: 2px;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .hide {
        display: none;
      }

      .helper:hover + .hide {
        display: block;
        position: absolute;
        color: red;
        z-index: 999999;
        background-color: white;
      }

      #dropdownsection {
        display: block;
        margin-left: auto;
        margin-right: auto;
        width: 80%;
      }

      #buttons {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-around;
      }

      .helper {
        font-size: 16px;
      }
    </style>
  <style></style></head>

  <body>
    <script type="text/javascript">
      function ShowHideDiv() {
        var categories = document.getElementById("categories");
        var source = document.getElementById("source");
        source.style.display = categories.value == "Source" ? "block" : "none";
        driver.style.display = categories.value == "Driver" ? "block" : "none";
        path.style.display = categories.value == "Path" ? "block" : "none";
        trap.style.display = categories.value == "Trap" ? "block" : "none";
      }
    </script>

    <div id="wrapper">
      <div id="leftmenu">
        <h2>New Economy Minerals Compilation</h2>
        <h2>Silica Sands Prospectivity</h2>

        <div id="coefficients">
          <div class="coefficients_container">
            <div class="vertical">
              <div class="slidecontainer">
                <h3 class="helper">Coeff:</h3>
                <div class="hide">Coefficient</div>
                <div class="vertical2">
                  <p class="helper">Src : <span id="source_display"></span></p>
                  <div class="hide">Source</div>
                  <input type="range" min="0" max="1" value="1" class="slider" id="source_slide" step="0.1">
                </div>

                <div class="vertical2">
                  <p class="helper">Drv : <span id="driver_display"></span></p>
                  <div class="hide">Driver</div>
                  <input type="range" min="0" max="1" value="1" class="slider" id="driver_slide" step="0.1">
                </div>

              </div>
            </div>
          </div>
        </div>

        <div id="dropdownsection">
          <p id="categoryselection"></p>
          <span>Category Selection</span>
          <select id="categories" onchange="ShowHideDiv()">
            <option value="Source">Source</option>
            <option value="Driver">Driver</option>

          </select>
        </div>
        <hr>
        <div id="source">
          <div class="source_container">
            <div class="vertical">
              <div class="slidecontainer">
                <h3 class="helper">S1:</h3>
                <img class="hide" src="./Silica Sands Prospectivity_files/S1.png" alt="S1 Example" style="width: 200px; height: 300px">
                <div class="vertical2">
                  <p class="helper">Imp: <span id="S1_imp_display"></span></p>
                  <div class="hide">Importance Value</div>
                  <input type="range" min="0" max="1" value="0.9" class="slider" id="S1_imp" step="0.1">
                </div>

                <div class="vertical2">
                  <p class="helper">App: <span id="S1_App_display"></span></p>
                  <div class="hide">Applicability Value</div>
                  <input type="range" min="0" max="1" value="0.5" class="slider" id="S1_App" step="0.1">
                </div>
                <div class="vertical2">
                  <p class="helper">Con: <span id="S1_Con_display"></span></p>
                  <div class="hide">Confidence Value</div>
                  <input type="range" min="0" max="1" value="0.5" class="slider" id="S1_Con" step="0.1">
                </div>
                <div class="vertical3">
                  <p>Overall:</p>
                  <p>
                    <span id="S1_final_display"></span>
                  </p>
                </div>
              </div>

            </div>
          </div>
        </div>

        <div id="driver" style="display: none">
          <div class="driver_container">
            <div class="vertical">
              <div class="slidecontainer">
                <h3 class="helper">D1:</h3>
                <img class="hide" src="./Silica Sands Prospectivity_files/D1.png" alt="D1 Example" style="width: 200px; height: 300px">

                <div class="vertical2">
                  <p class="helper">Imp: <span id="D1_imp_display"></span></p>
                  <div class="hide">Importance Value</div>
                  <input type="range" min="0" max="1" value="0.9" class="slider" id="D1_imp" step="0.1">
                </div>

                <div class="vertical2">
                  <p class="helper">App: <span id="D1_App_display"></span></p>
                  <div class="hide">Applicability Value</div>
                  <input type="range" min="0" max="1" value="0.9" class="slider" id="D1_App" step="0.1">
                </div>

                <div class="vertical2">
                  <p class="helper">Con: <span id="D1_Con_display"></span></p>
                  <div class="hide">Confidence Value</div>
                  <input type="range" min="0" max="1" value="0.8" class="slider" id="D1_Con" step="0.1">
                </div>
                <div class="vertical3">
                  <p>Overall:</p>
                  <p>
                    <span id="D1_final_display"></span>
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="buttons">
          <button class="button" onclick="buildMap()">Show Low Res Tiff</button>
          <button class="button" onclick="buildHighResMap()">
            Show High Res Tiff
          </button>
          <button class="button" id="homebutton">Back to Homepage</button>
        </div>
        <div id="acknowledgementsection">
          <img class="uqlogo" src="./Silica Sands Prospectivity_files/UQ_logo.png" alt="UQ logo" style="width: 100%; margin-top: 40px">
          <img class="gsqlogo" src="./Silica Sands Prospectivity_files/GSQ_Logo_placeholder2.png" alt="GSQ logo" style="width: 100%; margin-top: 40px">
          <p style="font-weight: bold">Acknowledgements:</p>

          <p>
            Financial Support
            <br>Queensland Dept of Resources
            <br>
            <br>
            Open source code Based on "Georaster" of Daniel J Dufour
            <br>
            <br>
            Programming Michael JD Valenta
            <br>
            <br>
          </p>
        </div>
      </div>

      <div id="prospectivityMap"></div>
    </div>

    <script src="./Silica Sands Prospectivity_files/leaflet.js.download"></script>
    <script src="./Silica Sands Prospectivity_files/georaster"></script>
    <script src="./Silica Sands Prospectivity_files/chroma-js"></script>
    <script src="./Silica Sands Prospectivity_files/georaster-layer-for-leaflet"></script>

    <script src="./Silica Sands Prospectivity_files/spin.js.download"></script>
    <script src="./Silica Sands Prospectivity_files/leaflet.spin.min.js.download"></script>

    <script type="text/javascript">
      document.getElementById("homebutton").onclick = function () {
        location.href = "https://smi.uq.edu.au/project/queensland-new-economy-minerals-compilation";
      };
    </script>

    <script>
      function buildMap() {
        // coefficients slider code starts

        var source_slider = document.getElementById("source_slide");
        var source_output = document.getElementById("source_display");
        var driver_slider = document.getElementById("driver_slide");
        var driver_output = document.getElementById("driver_display");

        source_output.innerHTML = source_slider.value; // Display the default slider value
        driver_output.innerHTML = driver_slider.value;

        // Update the current slider value (each time you drag the slider handle)
        source_slider.oninput = function () {
          source_output.innerHTML = this.value;
        };
        driver_slider.oninput = function () {
          driver_output.innerHTML = this.value;
        };

        var SCoeff = source_slider.value;
        var DCoeff = driver_slider.value;

        //coefficients slider code ends

        // S1 slider code starts

        var S1_imp_slider = document.getElementById("S1_imp");
        var S1_imp_output = document.getElementById("S1_imp_display");
        var S1_App_slider = document.getElementById("S1_App");
        var S1_App_output = document.getElementById("S1_App_display");
        var S1_Con_slider = document.getElementById("S1_Con");
        var S1_Con_output = document.getElementById("S1_Con_display");

        S1_imp_output.innerHTML = S1_imp_slider.value; // Display the default slider value
        S1_App_output.innerHTML = S1_App_slider.value;
        S1_Con_output.innerHTML = S1_Con_slider.value;

        var S1 =
          S1_imp_slider.value * S1_App_slider.value * S1_Con_slider.value;

        // Update the current slider value (each time you drag the slider handle)
        S1_imp_slider.oninput = function () {
          S1_imp_output.innerHTML = this.value;
        };
        S1_App_slider.oninput = function () {
          S1_App_output.innerHTML = this.value;
        };
        S1_Con_slider.oninput = function () {
          S1_Con_output.innerHTML = this.value;
        };

        var S1_final_output = document.getElementById("S1_final_display");
        S1_final_output.innerHTML = +S1.toFixed(2);
        // console.log("S1 output is: " + S1);

        //S1 slider code ends

        //D1 slider code starts

        var D1_imp_slider = document.getElementById("D1_imp");
        var D1_imp_output = document.getElementById("D1_imp_display");
        var D1_App_slider = document.getElementById("D1_App");
        var D1_App_output = document.getElementById("D1_App_display");
        var D1_Con_slider = document.getElementById("D1_Con");
        var D1_Con_output = document.getElementById("D1_Con_display");

        D1_imp_output.innerHTML = D1_imp_slider.value; // Display the default slider value
        D1_App_output.innerHTML = D1_App_slider.value;
        D1_Con_output.innerHTML = D1_Con_slider.value;

        var D1 =
          D1_imp_slider.value * D1_App_slider.value * D1_Con_slider.value;

        // Update the current slider value (each time you drag the slider handle)
        D1_imp_slider.oninput = function () {
          D1_imp_output.innerHTML = this.value;
        };
        D1_App_slider.oninput = function () {
          D1_App_output.innerHTML = this.value;
        };
        D1_Con_slider.oninput = function () {
          D1_Con_output.innerHTML = this.value;
        };

        var D1_final_output = document.getElementById("D1_final_display");
        D1_final_output.innerHTML = +D1.toFixed(2);
        // console.log("D1 output is: " + D1);

        //D1 slider code ends

        document.getElementById("prospectivityMap").innerHTML =
          "<div id='map'></div>";

        var osmUrl = "http://{s}.tile.osm.org/{z}/{x}/{y}.png",
          osmAttribution =
            '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',
          osmLayer = new L.TileLayer(osmUrl, {
            maxZoom: 18,
            attribution: osmAttribution,
          });
        var map = new L.Map("map");
        map.setView(new L.LatLng(-20.5, 146), 6);
        map.addLayer(osmLayer);

        L.Control.Watermark = L.Control.extend({
          onAdd: function (map) {
            var img = L.DomUtil.create("img");
            img.src = "https://nemicomp.s3.ap-southeast-2.amazonaws.com/images/scale_bar.png";
            img.style.width = "50px";
            img.style.padding = "15px";
            return img;
          },
          onRemove: function (map) {},
        });

        L.control.watermark = function (opts) {
          return new L.Control.Watermark(opts);
        };

        L.control.watermark({ position: "bottomleft" }).addTo(map);

        map.spin(true);

        // below is a multiband
        var url_to_geotiff_file =
		  "http://gowminerals.byethost33.com/grids/SilicaSands_AllComponents_LowRes.tif";

        //code for storing pixel value in global variable

        fetch(url_to_geotiff_file)
          .then((response) => response.arrayBuffer())
          .then((arrayBuffer) => {
            parseGeoraster(arrayBuffer).then((georaster) => {
              // set the starting value for the maximum for the different bands
              var Smax = 0;
              var Dmax = 0;
              //var Pmax = 0;
              //var Tmax = 0;
              var Amax = 0;
              var scale = chroma.scale("Viridis");

              var layer = new GeoRasterLayer({
                georaster: georaster,
                opacity: 0.7,

                pixelValuesToColorFn: function (pixelValues) {
                  var SpixelValue =
                    pixelValues[0] * S1; //add the S bands with coefficients
                  // this if statement finds the S maximum - not sure why it works...
                  var Smax1 = Math.max(SpixelValue);
                  if (Smax1 > Smax) {
                    Smax = Smax1;
                  }
                  var DpixelValue = pixelValues[1] * D1; // add the D bands with coefficients
                  // this if statement finds the D maximum - not sure why it works...
                  var Dmax1 = Math.max(DpixelValue);
                  if (Dmax1 > Dmax) {
                    Dmax = Dmax1;
                  }


                  const Dmin = 0;

                  // scale all the components to 0 - 1 used by chroma
                  var scaledSPixelValue = (SpixelValue - Dmin) / (Smax - Dmin);
                  var scaledDPixelValue = (DpixelValue - Dmin) / (Dmax - Dmin);

                  var scaledPixelValue =
                    ((SpixelValue / Smax) * SCoeff + (DpixelValue / Dmax) * DCoeff) / (SCoeff * 0.65 + DCoeff * 0.65);
 
                  var color = scale(scaledPixelValue).hex();

                  return color;
                },

                resolution: 256,
              });

              console.log("layer:", layer);

              layer.addTo(map);

              map.fitBounds(layer.getBounds());

              map.spin(false);

              //stringifycode starts

              function cleanStringify(object) {
                if (object && typeof object === "object") {
                  object = copyWithoutCircularReferences([object], object);
                }
                return JSON.stringify(object);

                function copyWithoutCircularReferences(references, object) {
                  var cleanObject = {};
                  Object.keys(object).forEach(function (key) {
                    var value = object[key];
                    if (value && typeof value === "object") {
                      if (references.indexOf(value) < 0) {
                        references.push(value);
                        cleanObject[key] = copyWithoutCircularReferences(
                          references,
                          value
                        );
                        references.pop();
                      } else {
                        cleanObject[key] = "###_Circular_###";
                      }
                    } else if (typeof value !== "function") {
                      cleanObject[key] = value;
                    }
                  });
                  return cleanObject;
                }
              }

              //stringifycode ends

              //convert layer to json
              var jsonData = cleanStringify(layer);

              //download function
              function download(content, fileName, contentType) {
                var a = document.createElement("a");
                var file = new Blob([content], { type: contentType });
                a.href = URL.createObjectURL(file);
                a.download = fileName;
                a.click();
              }

              var element = document.getElementById("savebutton");
              element.onclick = function () {
                download(jsonData, "json.txt", "text/plain");
              };
            });
          });
      }

      function buildHighResMap() {
        // coefficients slider code starts

        var source_slider = document.getElementById("source_slide");
        var source_output = document.getElementById("source_display");
        var driver_slider = document.getElementById("driver_slide");
        var driver_output = document.getElementById("driver_display");

        source_output.innerHTML = source_slider.value; // Display the default slider value
        driver_output.innerHTML = driver_slider.value;

        // Update the current slider value (each time you drag the slider handle)
        source_slider.oninput = function () {
          source_output.innerHTML = this.value;
        };
        driver_slider.oninput = function () {
          driver_output.innerHTML = this.value;
        };

        var SCoeff = source_slider.value;
        var DCoeff = driver_slider.value;

        //coefficients slider code ends

        // S1 slider code starts

        var S1_imp_slider = document.getElementById("S1_imp");
        var S1_imp_output = document.getElementById("S1_imp_display");
        var S1_App_slider = document.getElementById("S1_App");
        var S1_App_output = document.getElementById("S1_App_display");
        var S1_Con_slider = document.getElementById("S1_Con");
        var S1_Con_output = document.getElementById("S1_Con_display");

        S1_imp_output.innerHTML = S1_imp_slider.value; // Display the default slider value
        S1_App_output.innerHTML = S1_App_slider.value;
        S1_Con_output.innerHTML = S1_Con_slider.value;

        var S1 =
          S1_imp_slider.value * S1_App_slider.value * S1_Con_slider.value;

        // Update the current slider value (each time you drag the slider handle)
        S1_imp_slider.oninput = function () {
          S1_imp_output.innerHTML = this.value;
        };
        S1_App_slider.oninput = function () {
          S1_App_output.innerHTML = this.value;
        };
        S1_Con_slider.oninput = function () {
          S1_Con_output.innerHTML = this.value;
        };

        var S1_final_output = document.getElementById("S1_final_display");
        S1_final_output.innerHTML = +S1.toFixed(2);
        // console.log("S1 output is: " + S1);

        //S1 slider code ends

		//D1 slider code starts
        var D1_imp_slider = document.getElementById("D1_imp");
        var D1_imp_output = document.getElementById("D1_imp_display");
        var D1_App_slider = document.getElementById("D1_App");
        var D1_App_output = document.getElementById("D1_App_display");
        var D1_Con_slider = document.getElementById("D1_Con");
        var D1_Con_output = document.getElementById("D1_Con_display");

        D1_imp_output.innerHTML = D1_imp_slider.value; // Display the default slider value
        D1_App_output.innerHTML = D1_App_slider.value;
        D1_Con_output.innerHTML = D1_Con_slider.value;

        var D1 =
          D1_imp_slider.value * D1_App_slider.value * D1_Con_slider.value;

        // Update the current slider value (each time you drag the slider handle)
        D1_imp_slider.oninput = function () {
          D1_imp_output.innerHTML = this.value;
        };
        D1_App_slider.oninput = function () {
          D1_App_output.innerHTML = this.value;
        };
        D1_Con_slider.oninput = function () {
          D1_Con_output.innerHTML = this.value;
        };

        var D1_final_output = document.getElementById("D1_final_display");
        D1_final_output.innerHTML = +D1.toFixed(2);
        // console.log("D1 output is: " + D1);

        //D1 slider code ends


        document.getElementById("prospectivityMap").innerHTML =
          "<div id='map'></div>";

        var osmUrl = "http://{s}.tile.osm.org/{z}/{x}/{y}.png",
          osmAttribution =
            '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',
          osmLayer = new L.TileLayer(osmUrl, {
            maxZoom: 18,
            attribution: osmAttribution,
          });
        var map = new L.Map("map");
        map.setView(new L.LatLng(-20.5, 146), 6);
        map.addLayer(osmLayer);

        L.Control.Watermark = L.Control.extend({
          onAdd: function (map) {
            var img = L.DomUtil.create("img");
            img.src = "https://nemicomp.s3.ap-southeast-2.amazonaws.com/images/scale_bar.png";
            img.style.width = "50px";
            img.style.padding = "15px";
            return img;
          },
          onRemove: function (map) {},
        });

        L.control.watermark = function (opts) {
          return new L.Control.Watermark(opts);
        };

        L.control.watermark({ position: "bottomleft" }).addTo(map);

        map.spin(true);

        // below is a multiband
        var url_to_geotiff_file =
          "http://gowminerals.byethost33.com/grids/SilicaSands_AllComponents_MedRes.tif";

        //code for storing pixel value in global variable

        fetch(url_to_geotiff_file)
          .then((response) => response.arrayBuffer())
          .then((arrayBuffer) => {
            parseGeoraster(arrayBuffer).then((georaster) => {
              // set the starting value for the maximum for the different bands
              var Smax = 0;
              var Dmax = 0;
              var Amax = 0;
              var scale = chroma.scale("Viridis");

              var layer = new GeoRasterLayer({
                georaster: georaster,
                opacity: 0.7,

                pixelValuesToColorFn: function (pixelValues) {
                  var SpixelValue =
                    pixelValues[0] * S1; //add the S bands with coefficients
                  // this if statement finds the S maximum - not sure why it works...
                  var Smax1 = Math.max(SpixelValue);
                  if (Smax1 > Smax) {
                    Smax = Smax1;
                  }
                  var DpixelValue = pixelValues[1] * D1; // add the D bands with coefficients
                  // this if statement finds the D maximum - not sure why it works...
                  var Dmax1 = Math.max(DpixelValue);
                  if (Dmax1 > Dmax) {
                    Dmax = Dmax1;
                  }

                  const Dmin = 0;

                  // scale all the components to 0 - 1 used by chroma
                  var scaledSPixelValue = (SpixelValue - Dmin) / (Smax - Dmin);
                  var scaledDPixelValue = (DpixelValue - Dmin) / (Dmax - Dmin);

                  var scaledPixelValue =
                    ((SpixelValue / Smax) * SCoeff + (DpixelValue / Dmax) * DCoeff) / (SCoeff * 0.65 + DCoeff * 0.65);

                  var color = scale(scaledPixelValue).hex();

                  return color;
                },

                resolution: 256,
              });

              console.log("layer:", layer);

              layer.addTo(map);

              map.fitBounds(layer.getBounds());

              map.spin(false);

              //stringifycode starts

              function cleanStringify(object) {
                if (object && typeof object === "object") {
                  object = copyWithoutCircularReferences([object], object);
                }
                return JSON.stringify(object);

                function copyWithoutCircularReferences(references, object) {
                  var cleanObject = {};
                  Object.keys(object).forEach(function (key) {
                    var value = object[key];
                    if (value && typeof value === "object") {
                      if (references.indexOf(value) < 0) {
                        references.push(value);
                        cleanObject[key] = copyWithoutCircularReferences(
                          references,
                          value
                        );
                        references.pop();
                      } else {
                        cleanObject[key] = "###_Circular_###";
                      }
                    } else if (typeof value !== "function") {
                      cleanObject[key] = value;
                    }
                  });
                  return cleanObject;
                }
              }

              //stringifycode ends

              // //   convert layer to json
              //   var jsonData = cleanStringify(layer);

              //download function
              function download(content, fileName, contentType) {
                var a = document.createElement("a");
                var file = new Blob([content], { type: contentType });
                a.href = URL.createObjectURL(file);
                a.download = fileName;
                a.click();
              }

              var element = document.getElementById("savebutton");
              element.onclick = function () {
                download(jsonData, "json.txt", "text/plain");
              };
            });
          });
      }
    </script>
  

</body></html>